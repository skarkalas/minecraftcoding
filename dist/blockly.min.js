(function(r,d,y){const g=document.getElementById(r),f=document.getElementById(d);var v={toolbox:document.getElementById(y),collapse:!0,trashcan:!0,horizontalLayout:!1,toolboxPosition:"start",media:"media/",scrollbars:!0,sounds:!0,oneBasedIndex:!1,grid:{spacing:20,length:3,colour:"#888",snap:!0},zoom:{controls:!0,wheel:!0,startScale:1,maxScale:3,minScale:.3,scaleSpeed:1.2}};let a;function m(){a=Blockly.inject(f,v),Blockly.JavaScript.STATEMENT_PREFIX=`highlightBlock(%1);
`,Blockly.JavaScript.addReservedWords("highlightBlock"),u(),a.addChangeListener(function(t){if(t.type==="create"||t.type==="delete"){const c=getEvent();c.id=t.blockId,c.type="instruction",c.event=t.type+"BlocklyBlock",c.source="player",c.state.method="mouse",t.type==="create"?c.state.command=t.json.type:c.state.command=t.oldJson.type,triggerActionEvent(c.event,c)}})}function P(t){a.highlightBlock(t)}function k(t,c){const n=t.createObject(t.OBJECT);var o=function(e){return alert(arguments.length?e:"")};t.setProperty(c,"alert",t.createNativeFunction(o)),o=function(e){return prompt(e)},t.setProperty(c,"prompt",t.createNativeFunction(o)),o=function(e){return a.highlightBlock(e)},t.setProperty(c,"highlightBlock",t.createNativeFunction(o)),o=function(){var e=Minecraft.getPlayerPosition();if(Array.isArray(e)){var i=t.nativeToPseudo(e);return i}return e},t.setProperty(n,"getPlayerPosition",t.createNativeFunction(o)),o=function(){var e=Minecraft.getCursorPosition();if(Array.isArray(e)){var i=t.nativeToPseudo(e);return i}return e},t.setProperty(n,"getCursorPosition",t.createNativeFunction(o)),o=function(e){return Minecraft.moveForward(e)},t.setProperty(n,"moveForward",t.createNativeFunction(o)),o=function(e){return Minecraft.moveBackward(e)},t.setProperty(n,"moveBackward",t.createNativeFunction(o)),o=function(e){return Minecraft.moveRight(e)},t.setProperty(n,"moveRight",t.createNativeFunction(o)),o=function(e){return Minecraft.moveLeft(e)},t.setProperty(n,"moveLeft",t.createNativeFunction(o)),o=function(e){return Minecraft.moveUp(e)},t.setProperty(n,"moveUp",t.createNativeFunction(o)),o=function(e){return Minecraft.moveDown(e)},t.setProperty(n,"moveDown",t.createNativeFunction(o)),o=function(e){return Minecraft.turnRight(e)},t.setProperty(n,"turnRight",t.createNativeFunction(o)),o=function(e){return Minecraft.turnLeft(e)},t.setProperty(n,"turnLeft",t.createNativeFunction(o)),o=function(e){return Minecraft.turnUp(e)},t.setProperty(n,"turnUp",t.createNativeFunction(o)),o=function(e){return Minecraft.turnDown(e)},t.setProperty(n,"turnDown",t.createNativeFunction(o)),o=function(){return Minecraft.selectGrass()},t.setProperty(n,"selectGrass",t.createNativeFunction(o)),o=function(){return Minecraft.selectDirt()},t.setProperty(n,"selectDirt",t.createNativeFunction(o)),o=function(){return Minecraft.selectStone()},t.setProperty(n,"selectStone",t.createNativeFunction(o)),o=function(){return Minecraft.selectWood()},t.setProperty(n,"selectWood",t.createNativeFunction(o)),o=function(){return Minecraft.selectBrick()},t.setProperty(n,"selectBrick",t.createNativeFunction(o)),o=function(e,i,l){return Minecraft.createBlock(e,i,l)},t.setProperty(n,"createBlock",t.createNativeFunction(o)),o=function(e,i,l){return Minecraft.destroyBlock(e,i,l)},t.setProperty(n,"destroyBlock",t.createNativeFunction(o)),t.setProperty(c,"Minecraft",n)}function u(){$(".blocklyWidgetDiv").prependTo(".modalblockly"),$(".blocklyTooltipDiv").prependTo(".modalblockly"),$(".blocklyDropDownDiv").prependTo(".modalblockly")}function s(){a&&Blockly.svgResize(a)}window.addEventListener("resize",s),document.addEventListener("DOMContentLoaded",function(){document.getElementById("ModalSlide").addEventListener("shown.bs.modal",()=>{a||m(),s(),u()})}),document.getElementById("run-code").addEventListener("click",function(){if(a){var t=Blockly.JavaScript.workspaceToCode(a);const o=getEvent();o.id=uuidv1(),o.type="code",o.event="executeBlocklyCode",o.source="player",o.state.method="mouse",o.state.code=t,console.log(t),triggerActionEvent(o.event,o);try{let e=function(){try{c.step()&&setTimeout(e,10)}catch(i){console.error(i.message),alert(i.message)}};var n=e,c=new Interpreter(t,k);e()}catch(e){console.error(e.message)}}}),document.querySelector("button#download-code").addEventListener("click",function(){function t(c,n){var o=document.createElement("a");o.setAttribute("href","data:application/json;charset=utf-8,"+encodeURIComponent(n)),o.setAttribute("download",c),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}if(a){const c=Blockly.serialization.workspaces.save(a);console.log(c),t(uuidv1()+".json",JSON.stringify(c,null,2))}}),document.querySelector("button#upload-code").addEventListener("click",t=>{document.querySelector("input#upload-file-input").click()}),document.querySelector("input#upload-file-input").addEventListener("change",t=>{const c=t.currentTarget,n=new FileReader;n.onload=function(){try{const o=n.result,e=JSON.parse(o);Blockly.serialization.workspaces.load(e,a)}catch(o){console.log(o)}},n.readAsText(c.files[0])}),document.querySelector("button#delete-code").addEventListener("click",t=>{a.clear()})})("blocklyArea","blocklyDiv","toolbox");
